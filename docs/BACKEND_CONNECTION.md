# Backend Connection Guide

This frontend repository is intrinsically linked to the **surf-website** backend repository.

## Repository Structure

```
/home/keelando/
├── envcan_wave/              # Backend repo (surf-website)
│   ├── Python data collection scripts
│   ├── SQLite databases (~/.local/share/*.sqlite)
│   └── Exports to → ~/site/data/
│
└── site/                     # Frontend repo (surf-website-front-end)
    ├── index.html, tides.html, forecasts.html
    ├── assets/js/           # JavaScript that fetches JSON data
    └── data/                # JSON files generated by backend ← Reads from here
```

## Data Flow

1. **Backend** (`~/envcan_wave/`):
   - `buoy_to_influx_sqlite.py` → Collects wave buoy data
   - `tide_to_sqlite.py` → Collects tide data
   - `sqlite_to_json.py` → Exports `~/site/data/latest_buoy_v2.json`
   - `export_tide_json.py` → Exports `~/site/data/tide-*.json`

2. **Frontend** (`~/site/`):
   - `assets/js/main.js` → Fetches `data/latest_buoy_v2.json`
   - `assets/js/tides.js` → Fetches `data/tide-*.json`
   - `assets/js/charts.js` → Renders data visualizations

## Working with Both Repositories

### CLI Multi-Directory Mode (Recommended)

```bash
# From anywhere on your system
claude-code --add-dir ~/envcan_wave --add-dir ~/site
```

This gives Claude full context of both repos in a single session.

### Alternative: Parent Directory

```bash
cd /home/keelando
claude-code .
```

### Separate Sessions (Web UI)

Open separate Claude Code sessions for each repo. Reference this document to understand the connection.

## Cross-Repo Development Pattern

When adding a feature that spans both repos (e.g., new wave stations):

1. **Start with backend** (in `surf-website`):
   - Add data collection scripts
   - Set up database schema
   - Create JSON export
   - Test that data flows to `~/site/data/`

2. **Switch to frontend** (in `surf-website-front-end`):
   - Update JavaScript to consume new JSON
   - Add UI elements
   - Test the integration

3. **Link commits across repos**:

**Backend commit:**
```
Add Windy API wave station data collection

Fetches wave data from two new stations via Windy API.
Exports to ~/site/data/windy_stations.json

Related: surf-website-front-end commit <hash> adds UI display
```

**Frontend commit:**
```
Display Windy wave stations on index page

Reads ~/site/data/windy_stations.json and renders cards.

Related: surf-website commit <hash> adds data collection
```

## JSON Data Contracts

**Buoy Data** (`~/site/data/latest_buoy_v2.json`):
```json
{
  "4600146": {
    "buoy_id": "4600146",
    "wave_height_sig": 2.5,
    "wind_speed": 15.3,
    "observation_time": "2025-11-06T08:30:00Z"
  }
}
```

**Tide Data** (`~/site/data/tide-latest.json`, `tide-timeseries.json`, `tide-hi-low.json`):
- See backend CLAUDE.md for schema details

## Why Separate Repositories?

The backend and frontend remain separate because:
- Different deployment patterns (cron vs web server)
- Different tech stacks (Python vs static HTML/JS)
- Backend has credentials, frontend is public
- Clean separation via JSON interface

Use Claude Code's multi-directory support to bridge the gap when needed.

## Testing the Connection

```bash
# Verify JSON files are being generated
ls -lh ~/site/data/

# Check latest buoy data
cat ~/site/data/latest_buoy_v2.json | jq .

# Check tide data
cat ~/site/data/tide-latest.json | jq .

# Monitor backend logs
tail -f ~/envcan_wave/*.log
```

## Quick Reference

**When to work in each repo:**
- **Backend repo**: Change data structure, add new stations, debug missing data
- **Frontend repo**: Change UI/display, update styling, modify charts
- **Both repos**: Add new data types, change JSON contracts

**Backend repo path:** `~/envcan_wave/` (likely `/home/keelando/envcan_wave/`)
